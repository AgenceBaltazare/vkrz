<?php
include __DIR__ . '/../../../../wp-load.php';
/**
 * CRON JOB : Update money generated by activity for all creators users
 *
 * When : Everyday @ 03:00
 */
$user_query = new WP_User_Query(
    array(
        'number' => -1,
        'role__in' => array('administrator', 'author')
    )
);
$users = $user_query->get_results();
foreach ($users as $user) {
    $user_id = $user->ID;
    $vainkeur_entry = new WP_Query(array(
        'post_type'              => 'vainkeur',
        'posts_per_page'         => '1',
        'fields'                 => 'ids',
        'post_status'            => 'publish',
        'ignore_sticky_posts'    => true,
        'update_post_meta_cache' => false,
        'no_found_rows'          => false,
        'author'                 => $user_id
    ));

    if ($vainkeur_entry->have_posts()) {
        $id_vainkeur    = $vainkeur_entry->posts[0];
    }
    $total_money       = get_creator_money_for_duplicated($user_id);


    $current_money          = intval(get_field('money_disponible_vkrz', $id_vainkeur));
    $current_money_creator  = intval(get_field('money_creator_vkrz', $id_vainkeur));
    $money_duplicated       = $current_money_creator + $total_money['money_duplicated'];
    $new_money_dispo        = $current_money - $current_money_creator + $money_duplicated;

    update_field('money_creator_vkrz', $new_money_dispo, $id_vainkeur);
    update_field('money_disponible_vkrz', $money_duplicated, $id_vainkeur);

}