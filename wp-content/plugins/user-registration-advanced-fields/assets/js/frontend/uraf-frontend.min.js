jQuery(function(u){var e=function(){if("undefined"==typeof user_registration_params)return!1;u(document).on("user_registration_frontend_form_data_render",function(e,r,t){"input"===r.get(0).tagName.toLowerCase()&&r.hasClass(".uraf-profile-picture-input")&&"undefined"!==r.val()&&0<r.val()&&(t.value=r.val())});var n={init:function(){u(document).ready(n.ready),this.load_validation(),this.init_event()},ready:function(){n.loadPhoneField()},load_validation:function(){if("undefined"==typeof u.fn.validate)return!1},loadPhoneField:function(){var r="",i={};if("undefined"==typeof u.fn.intlTelInput)return!1;if("yes"!==user_registration_params.disable_user_details&&(i.geoIpLookup=n.currentIpToCountry),"yes"===user_registration_params.disable_user_details){var e=this.getFirstBrowserLanguage();r=-1<e.indexOf("-")?e.split("-").pop():""}if(r){var t=window.intlTelInputGlobals.getCountryData();r=(t=t.filter(function(e){return e.iso2===r.toLowerCase()})).length?r:""}i.initialCountry="yes"===user_registration_params.disable_user_details&&r?r:"auto",u(".ur-smart-phone-field").each(function(e,r){var t=u(r);i.hiddenInput=t.data("id"),i.utilsScript=user_registration_advanced_fields_params.utils_url,t.intlTelInput(i),t.blur(function(){var e=t.closest("p.form-row");if(t.intlTelInput("isValidNumber"))t.siblings('input[type="hidden"]').val(t.intlTelInput("getNumber")),e.find("#"+t.data("id")).attr("aria-invalid",!1),e.find("#"+t.data("id")+"-error").remove();else if(""!==t.val()){e.find("#"+t.data("id")+"-error").remove();var r='<label id="'+t.data("id")+'-error" class="user-registration-error" for="'+t.data("id")+'">'+user_registration_params.message_validate_phone_number+"</label>";e.append(r),e.find("#"+t.data("id")).attr("aria-invalid",!0)}})})},getFirstBrowserLanguage:function(){var e,r,t=window.navigator,i=["language","browserLanguage","systemLanguage","userLanguage"];if(Array.isArray(t.languages))for(e=0;e<t.languages.length;e++)if((r=t.languages[e])&&r.length)return r;for(e=0;e<i.length;e++)if((r=t[i[e]])&&r.length)return r;return""},currentIpToCountry:function(i){u.get("https://ipapi.co/json").always(function(e){var r=e&&e.country?e.country:"";if(!r){var t=n.getFirstBrowserLanguage();r=-1<t.indexOf("-")?t.split("-").pop():""}i(r)})},dataURItoBlob:function(e){var r;r=0<=e.split(",")[0].indexOf("base64")?atob(e.split(",")[1]):unescape(e.split(",")[1]);for(var t=e.split(",")[0].split(":")[1].split(";")[0],i=new Uint8Array(r.length),a=0;a<r.length;a++)i[a]=r.charCodeAt(a);return new Blob([i],{type:t})},send_file:function(o){var e=user_registration_advanced_fields_params.ajax_url+"?action=uraf_profile_picture_upload_method_upload&security="+user_registration_advanced_fields_params.uraf_profile_picture_upload_nonce,r=new FormData,t=u("#crop_container").attr("src");if(o[0].files[0])r.append("file",o[0].files[0]);else{var i=n.dataURItoBlob(t),a=new File([i],"snapshot.jpg");r.append("file",a)}r.append("cropped_image",u(".cropped_image_size").val());var s=o.closest(".uraf-profile-picture-upload").find(".wp_uraf_profile_picture_upload"),l=s.text();u.ajax({url:e,data:r,type:"POST",processData:!1,contentType:!1,beforeSend:function(){s.text(user_registration_advanced_fields_params.uraf_profile_picture_uploading)},complete:function(e){var r="",t=0,i="";o.parent().parent().parent().find(".user-registration-error").remove(),o.closest(".uraf-profile-picture-upload").find(".uraf-profile-picture-input").val("");try{var a=JSON.parse(e.responseText);if("undefined"==typeof a.success||"undefined"==typeof a.data)throw user_registration_advanced_fields_params.uraf_profile_picture_something_wrong;r=a.data.message,a.success||(r='<p class="uraf-profile-picture-error user-registration-error">'+r+"</p>"),a.success&&(r="",t=a.data.attachment_id,i=a.data.profile_picture_url,u(".user-registration-img-container").find(".profile-preview").attr("src",i),o.closest(".uraf-profile-picture-upload").find(".profile-preview").attr("src",i))}catch(n){r=user_registration_advanced_fields_params.uraf_profile_picture_something_wrong}o.closest(".uraf-profile-picture-upload").find(".uraf-profile-picture-remove").removeAttr("style"),o.closest(".uraf-profile-picture-upload").find(".wp_uraf_take_snapshot ").attr("style","display:none"),o.closest(".uraf-profile-picture-upload").find(".wp_uraf_profile_picture_upload ").attr("style","display:none"),o.closest(".uraf-profile-picture-upload").find(".uraf-profile-picture-error").remove(),o.closest(".uraf-profile-picture-upload").find(".uraf-profile-picture-file-error").remove(),o.closest(".uraf-profile-picture-upload").append('<span class="uraf-profile-picture-file-error">'+r+"</span>"),0<t&&o.closest(".uraf-profile-picture-upload").find(".uraf-profile-picture-input").val(i),s.text(l)}})},crop_image:function(r){var t;u("#crop_container").Jcrop({aspectRatio:1,onSelect:function(e){t={x:e.x,y:e.y,w:e.w,h:e.h}},setSelect:[100,100,50,50]}),u(".swal2-confirm").on("click",function(){var e={x:t.x,y:t.y,w:t.w,h:t.h,holder_width:u("#crop_container").css("width"),holder_height:u("#crop_container").css("height")};u(".cropped_image_size").val(JSON.stringify(e)),n.send_file(r)})},init_event:function(){n.handle_profile_picture_upload(),n.handle_range_field()},handle_profile_picture_upload:function(){u("body").on("change",'.uraf-profile-picture-upload-node input[type="file"]',function(){if(this.files&&this.files[0]){var e=new FileReader;e.onload=function(e){u(".img").attr("src",e.target.result)},e.readAsDataURL(this.files[0]);Swal.fire({title:user_registration_advanced_fields_params.uraf_profile_picture_crop_picture_title,html:'<img id="crop_container" src="#" alt="your image" class="img"/><input type="hidden" name="cropped_image" class="cropped_image_size"/>',confirmButtonText:user_registration_advanced_fields_params.uraf_profile_picture_crop_picture_button,allowOutsideClick:!1,showCancelButton:!0,cancelButtonText:user_registration_advanced_fields_params.uraf_profile_picture_cancel_button,customClass:{container:"user-registration-swal2-container"}}),u(".swal2-cancel ").on("click",function(){u(".uraf-profile-picture-upload").find("#ur-profile-pic").val("")}),n.crop_image(u(this))}}),u(document).on("click",".wp_uraf_profile_picture_upload",function(){u(this).closest(".uraf-profile-picture-upload").find('input[type="file"]').trigger("click")}),u(document).on("click",".wp_uraf_take_snapshot",function(){var r=u(this);Swal.fire({title:user_registration_advanced_fields_params.uraf_profile_picture_capture,html:'<div id="my_camera"></div>',confirmButtonText:user_registration_advanced_fields_params.uraf_profile_picture_capture,allowOutsideClick:!1,showCancelButton:!0,cancelButtonText:user_registration_advanced_fields_params.uraf_profile_picture_cancel_button,customClass:{container:"user-registration-swal2-container"}});var e=320,t=240;u(window).width()<u(window).height()&&(e=240,t=320),Webcam.set({width:e,height:t,dest_width:e,dest_height:t,crop_width:e,crop_height:t,image_format:"jpeg",jpeg_quality:90});var i=!1;Webcam.on("error",function(e){var r="",t="";t="WebcamError"===e.name?(r=user_registration_advanced_fields_params.uraf_profile_picture_ssl_error_title,user_registration_advanced_fields_params.uraf_profile_picture_ssl_error_text):(r=user_registration_advanced_fields_params.uraf_profile_picture_permission_error_title,user_registration_advanced_fields_params.uraf_profile_picture_permission_error_text),i=!0,swal.fire({type:"warning",title:r,html:t,showConfirmButton:!1,showCancelButton:!0,cancelButtonText:user_registration_advanced_fields_params.uraf_profile_picture_cancel_button_confirmation,cancelButtonColor:"#236bb0",customClass:{container:"user-registration-swal2-container"}})}),i||(Webcam.attach("#my_camera"),u(".swal2-confirm").on("click",function(){Webcam.snap(function(e){Swal.fire({title:user_registration_advanced_fields_params.uraf_profile_picture_crop_picture_title,html:'<img id="crop_container" src="#" alt="your image" class="img"/><input type="hidden" name="cropped_image" class="cropped_image_size"/>',confirmButtonText:user_registration_advanced_fields_params.uraf_profile_picture_crop_picture_button,allowOutsideClick:!1,showCancelButton:!0,cancelButtonText:user_registration_advanced_fields_params.uraf_profile_picture_cancel_button,customClass:{container:"user-registration-swal2-container"}}),u("#crop_container").attr("src",e),n.crop_image(r.closest(".uraf-profile-picture-upload").find('.uraf-profile-picture-upload-node input[type="file"]'))}),Webcam.reset()}),u(".swal2-cancel").on("click",function(){Webcam.reset()}))}),u(document).on("click",".uraf-profile-picture-remove",function(){u(this).closest(".uraf-profile-picture-upload").find("#ur-profile-pic").val(""),u(this).closest(".uraf-profile-picture-upload").find(".uraf-profile-picture-file-error").remove(),u(".profile-preview").attr("src","https://secure.gravatar.com/avatar/?s=96&d=mm&r=g"),u(this).closest(".uraf-profile-picture-upload").find(".uraf-profile-picture-remove").attr("style","display:none"),u(this).closest(".uraf-profile-picture-upload").find(".wp_uraf_take_snapshot ").removeAttr("style"),u(this).closest(".uraf-profile-picture-upload").find(".wp_uraf_profile_picture_upload ").removeAttr("style"),u(this).closest(".uraf-profile-picture-upload").find('input[type="file"]').off("click")})},handle_range_field:function(){u(".ur-range-slider").each(function(){var e=u(this),r=u(this).closest(".ur-range-row").find(".ur-range-input"),t=u(this).closest(".ur-range-row").find(".ur-range-slider-reset-icon"),i=e.val();r.val(i),e.on("change",function(){var e=u(this).val();r.val(e),n.render_range_bubble(u(this))}),r.on("change",function(){e.val(u(this).val()),n.render_range_bubble(e)}),t.on("click",function(){e.val(i),r.val(i),n.render_range_bubble(e)})})},render_range_bubble:function(e){var r,t=e.attr("max"),i=e.attr("min"),a=t-i,n=(e.val()-i)/a,o=e.width(),s=-1;n<0?r=0:1<n?r=o:(r=o*n+s,s-=n),e.next("output").css({left:r,marginLeft:s+"%"}).text(e.val()).show().trigger("change")}};n.init(jQuery),jQuery(document).ready(function(){jQuery(".input-timepicker").timepicker({disableTextInput:!0}),u(".ur-frontend-form").find("form.edit-profile").hasClass("user-registration-EditProfileForm")&&u(".ur-smart-phone-field").each(function(e,r){var t=u(r),i=t.val();t.siblings('input[type="hidden"]').val(i)}),jQuery(".ur-field-item.field-select2 select, .ur-field-item.field-multi_select2 select, select.ur-field-profile-select2").selectWoo()}),u(document).on("user_registration_frontend_after_ajax_complete",function(e,r,t,i){"message"===t&&(i.find("#ur-profile-pic").val(""),i.find(".uraf-profile-picture-file-error").remove(),u(".profile-preview").attr("src","https://secure.gravatar.com/avatar/?s=96&d=mm&r=g"),i.find(".uraf-profile-picture-remove").attr("style","display:none"),i.find(".wp_uraf_take_snapshot ").removeAttr("style"),i.find(".wp_uraf_profile_picture_upload ").removeAttr("style"),i.find('input[type="file"]').off("click"))})};e(jQuery),u(document).on("elementor/popup/show",function(){u(document).off("click",".wp_uraf_profile_picture_upload"),e(jQuery)})});