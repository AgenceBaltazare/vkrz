!function(he){he.Jcrop=function(e,t){var c,C=he.extend({},he.Jcrop.defaults),n=navigator.userAgent.toLowerCase(),o=/msie/.test(n),a=/msie [1-6]\./.test(n);function x(e){return Math.round(e)+"px"}function S(e){return C.baseClass+"-"+e}function u(e){var t=he(e).offset();return[t.left,t.top]}function h(e){return[e.pageX-c[0],e.pageY-c[1]]}function r(e){"object"!=typeof e&&(e={}),C=he.extend(C,e),he.each(["onChange","onSelect","onRelease","onDblClick"],function(e,t){"function"!=typeof C[t]&&(C[t]=function(){})})}function i(e,t,n){if(c=u(O),Q.setCursor("move"===e?e:e+"-resize"),"move"===e)return Q.activateHandlers(function a(e){var t=e;return U.watchKeys(),function(e){G.moveOffset([e[0]-t[0],e[1]-t[1]]),t=e,V.update()}}(t),l,n);var o=G.getFixed(),r=d(e),i=G.getCorner(d(r));G.setPressed(G.getCorner(r)),G.setCurrent(i),Q.activateHandlers(function s(t,n){return function(e){if(C.aspectRatio)switch(t){case"e":case"w":e[1]=n.y+1;break;case"n":case"s":e[0]=n.x+1}else switch(t){case"e":case"w":e[1]=n.y2;break;case"n":case"s":e[0]=n.x2}G.setCurrent(e),V.update()}}(e,o),l,n)}function d(e){switch(e){case"n":return"sw";case"s":case"e":return"nw";case"w":return"ne";case"ne":return"sw";case"nw":return"se";case"se":return"nw";case"sw":return"ne"}}function k(t){return function(e){return C.disabled||("move"!==t||C.allowMove)&&(c=u(O),K=!0,i(t,h(e)),e.stopPropagation(),e.preventDefault()),!1}}function s(e,t,n){var o=e.width(),r=e.height();t<o&&0<t&&(r=(o=t)/e.width()*e.height()),n<r&&0<n&&(o=(r=n)/e.height()*e.width()),R=e.width()/o,T=e.height()/r,e.width(o).height(r)}function z(e){return{x:e.x*R,y:e.y*T,x2:e.x2*R,y2:e.y2*T,w:e.w*R,h:e.h*T}}function l(e){var t=G.getFixed();t.w>C.minSelect[0]&&t.h>C.minSelect[1]?(V.enableHandles(),V.done()):V.release(),Q.setCursor(C.allowSelect?"crosshair":"default")}function f(e){if(C.disabled)return!1;if(!C.allowSelect)return!1;K=!0,c=u(O),V.disableHandles(),Q.setCursor("crosshair");var t=h(e);return G.setPressed(t),V.update(),Q.activateHandlers(p,l,"touch"===e.type.substring(0,5)),U.watchKeys(),e.stopPropagation(),e.preventDefault(),!1}function p(e){G.setCurrent(e),V.update()}function M(){var e=he("<div></div>").addClass(S("tracker"));return o&&e.css({opacity:0,backgroundColor:"white"}),e}"object"!=typeof e&&(e=he(e)[0]),"object"!=typeof t&&(t={}),r(t);var g={border:"none",visibility:"visible",margin:0,padding:0,position:"absolute",top:0,left:0},b=he(e),w=!0;if("IMG"==e.tagName){if(0!=b[0].width&&0!=b[0].height)b.width(b[0].width),b.height(b[0].height);else{var v=new Image;v.src=b[0].src,b.width(v.width),b.height(v.height)}var O=b.clone().removeAttr("id").css(g).show();O.width(b.width()),O.height(b.height()),b.after(O).hide()}else O=b.css(g).show(),w=!1,null===C.shade&&(C.shade=!0);s(O,C.boxWidth,C.boxHeight);var y=O.width(),m=O.height(),j=he("<div />").width(y).height(m).addClass(S("holder")).css({position:"relative",backgroundColor:C.bgColor}).insertAfter(b).append(O);C.addClass&&j.addClass(C.addClass);var F=he("<div />"),H=he("<div />").width("100%").height("100%").css({zIndex:310,position:"absolute",overflow:"hidden"}),D=he("<div />").width("100%").height("100%").css("zIndex",320),I=he("<div />").css({position:"absolute",zIndex:600}).dblclick(function(){var e=G.getFixed();C.onDblClick.call(oe,e)}).insertBefore(O).append(H,D);w&&(F=he("<img />").attr("src",O.attr("src")).css(g).width(y).height(m),H.append(F)),a&&I.css({overflowY:"hidden"});var B,P,J,A,R,T,K,E,W=C.boundary,Y=M().width(y+2*W).height(m+2*W).css({position:"absolute",top:x(-W),left:x(-W),zIndex:290}).mousedown(f),q=C.bgColor,L=C.bgOpacity;c=u(O);var X=function(){function e(){var e,t={},n=["touchstart","touchmove","touchend"],o=document.createElement("div");try{for(e=0;e<n.length;e++){var r=n[e],i=(r="on"+r)in o;i||(o.setAttribute(r,"return;"),i="function"==typeof o[r]),t[n[e]]=i}return t.touchstart&&t.touchend&&t.touchmove}catch(a){return!1}}return{createDragger:function(t){return function(e){return C.disabled||("move"!==t||C.allowMove)&&(c=u(O),K=!0,i(t,h(X.cfilter(e)),!0),e.stopPropagation(),e.preventDefault()),!1}},newSelection:function(e){return f(X.cfilter(e))},cfilter:function(e){return e.pageX=e.originalEvent.changedTouches[0].pageX,e.pageY=e.originalEvent.changedTouches[0].pageY,e},isSupported:e,support:function t(){return!0===C.touchSupport||!1===C.touchSupport?C.touchSupport:e()}()}}(),G=function(){var t,n,f=0,p=0,g=0,b=0;function o(){if(!C.aspectRatio)return function h(){var e,t=g-f,n=b-p;B&&Math.abs(t)>B&&(g=0<t?f+B:f-B);P&&Math.abs(n)>P&&(b=0<n?p+P:p-P);A/T&&Math.abs(n)<A/T&&(b=0<n?p+A/T:p-A/T);J/R&&Math.abs(t)<J/R&&(g=0<t?f+J/R:f-J/R);f<0&&(g-=f,f-=f);p<0&&(b-=p,p-=p);g<0&&(f-=g,g-=g);b<0&&(p-=b,b-=b);y<g&&(f-=e=g-y,g-=e);m<b&&(p-=e=b-m,b-=e);y<f&&(b-=e=f-m,p-=e);m<p&&(b-=e=p-m,p-=e);return v(w(f,p,g,b))}();var e,t,n,o,r=C.aspectRatio,i=C.minSize[0]/R,a=C.maxSize[0]/R,s=C.maxSize[1]/T,c=g-f,u=b-p,d=Math.abs(c),l=Math.abs(u);return 0===a&&(a=10*y),0===s&&(s=10*m),d/l<r?(t=b,n=l*r,(e=c<0?f-n:n+f)<0?(e=0,o=Math.abs((e-f)/r),t=u<0?p-o:o+p):y<e&&(e=y,o=Math.abs((e-f)/r),t=u<0?p-o:o+p)):(e=g,o=d/r,(t=u<0?p-o:p+o)<0?(t=0,n=Math.abs((t-p)*r),e=c<0?f-n:n+f):m<t&&(t=m,n=Math.abs(t-p)*r,e=c<0?f-n:n+f)),f<e?(e-f<i?e=f+i:a<e-f&&(e=f+a),t=p<t?p+(e-f)/r:p-(e-f)/r):e<f&&(f-e<i?e=f-i:a<f-e&&(e=f-a),t=p<t?p+(f-e)/r:p-(f-e)/r),e<0?(f-=e,e=0):y<e&&(f-=e-y,e=y),t<0?(p-=t,t=0):m<t&&(p-=t-m,t=m),v(w(f,p,e,t))}function r(e){return e[0]<0&&(e[0]=0),e[1]<0&&(e[1]=0),e[0]>y&&(e[0]=y),e[1]>m&&(e[1]=m),[Math.round(e[0]),Math.round(e[1])]}function w(e,t,n,o){var r=e,i=n,a=t,s=o;return n<e&&(r=n,i=e),o<t&&(a=o,s=t),[r,a,i,s]}function v(e){return{x:e[0],y:e[1],x2:e[2],y2:e[3],w:e[2]-e[0],h:e[3]-e[1]}}return{flipCoords:w,setPressed:function i(e){e=r(e),g=f=e[0],b=p=e[1]},setCurrent:function a(e){e=r(e),t=e[0]-g,n=e[1]-b,g=e[0],b=e[1]},getOffset:function e(){return[t,n]},moveOffset:function s(e){var t=e[0],n=e[1];f+t<0&&(t-=t+f),p+n<0&&(n-=n+p),m<b+n&&(n+=m-(b+n)),y<g+t&&(t+=y-(g+t)),f+=t,g+=t,p+=n,b+=n},getCorner:function c(e){var t=o();switch(e){case"ne":return[t.x2,t.y];case"nw":return[t.x,t.y];case"se":return[t.x2,t.y2];case"sw":return[t.x,t.y2]}},getFixed:o}}(),N=function(){var n=!1,o=he("<div />").css({position:"absolute",zIndex:240,opacity:0}),r={top:i(),left:i().height(m),right:i().height(m),bottom:i()};function e(){return t(G.getFixed())}function t(e){r.top.css({left:x(e.x),width:x(e.w),height:x(e.y)}),r.bottom.css({top:x(e.y2),left:x(e.x),width:x(e.w),height:x(m-e.y2)}),r.right.css({left:x(e.x2),width:x(y-e.x2)}),r.left.css({width:x(e.x)})}function i(){return he("<div />").css({position:"absolute",backgroundColor:C.shadeColor||C.bgColor}).appendTo(o)}function a(){n||(n=!0,o.insertBefore(O),e(),V.setBgOpacity(1,0,1),F.hide(),s(C.shadeColor||C.bgColor,1),V.isAwake()?u(C.bgOpacity,1):u(1,1))}function s(e,t){te(d(),e,t)}function c(){n&&(o.remove(),F.show(),n=!1,V.isAwake()?V.setBgOpacity(C.bgOpacity,1,1):(V.setBgOpacity(1,1,1),V.disableHandles()),te(j,0,1))}function u(e,t){n&&(C.bgFade&&!t?o.animate({opacity:1-e},{queue:!1,duration:C.fadeTime}):o.css({opacity:1-e}))}function d(){return o.children()}return{update:e,updateRaw:t,getShades:d,setBgColor:s,enable:a,disable:c,resize:function l(e,t){r.left.css({height:x(t)}),r.right.css({height:x(t)})},refresh:function h(){C.shade?a():c(),V.isAwake()&&u(C.bgOpacity)},opacity:u}}(),V=function(){var i,a=370,s={},c={},n={},e=!1;function u(e,t){var n=he("<div />").mousedown(k(e)).css({cursor:e+"-resize",position:"absolute",zIndex:t}).addClass("ord-"+e);return X.support&&n.bind("touchstart.jcrop",X.createDragger(e)),D.append(n),n}function t(){var e=G.getFixed();G.setPressed([e.x,e.y]),G.setCurrent([e.x2,e.y2]),o()}function o(e){if(i)return r(e)}function r(e){var t=G.getFixed();!function n(e,t){I.width(Math.round(e)).height(Math.round(t))}(t.w,t.h),function o(e,t){C.shade||F.css({top:x(-t),left:x(-e)}),I.css({top:x(t),left:x(e)})}(t.x,t.y),C.shade&&N.updateRaw(t),i||function r(){I.show(),C.shade?N.opacity(L):d(L,!0);i=!0}(),e?C.onSelect.call(oe,z(t)):C.onChange.call(oe,z(t))}function d(e,t,n){(i||t)&&(C.bgFade&&!n?O.animate({opacity:e},{queue:!1,duration:C.fadeTime}):O.css("opacity",e))}function l(){if(e=!0,C.allowResize)return D.show(),!0}function h(){e=!1,D.hide()}function f(e){e?(E=!0,h()):(E=!1,l())}C.dragEdges&&he.isArray(C.createDragbars)&&!function g(e){var t;for(t=0;t<e.length;t++)n[e[t]]=u(e[t],a++).addClass("jcrop-dragbar")}(C.createDragbars),he.isArray(C.createHandles)&&function b(e){var t,n,o,r;for(t=0;t<e.length;t++)c[e[t]]=(n=e[t],r=void 0,o=C.handleSize,r=u(n,a++).css({opacity:C.handleOpacity}).addClass(S("handle")),o&&r.width(o).height(o),r)}(C.createHandles),C.drawBorders&&he.isArray(C.createBorders)&&function w(e){var t,n,o,r;for(n=0;n<e.length;n++){switch(e[n]){case"n":t="hline";break;case"s":t="hline bottom";break;case"e":t="vline right";break;case"w":t="vline"}s[e[n]]=(o=t,r=he("<div />").css({position:"absolute",opacity:C.borderOpacity}).addClass(S(o)),H.append(r),r)}}(C.createBorders),he(document).bind("touchstart.jcrop-ios",function(e){he(e.currentTarget).hasClass("jcrop-tracker")&&e.stopPropagation()});var p=M().mousedown(k("move")).css({cursor:"move",position:"absolute",zIndex:360});return X.support&&p.bind("touchstart.jcrop",X.createDragger("move")),H.append(p),h(),{updateVisible:o,update:r,release:function v(){h(),I.hide(),C.shade?N.opacity(1):d(1),i=!1,C.onRelease.call(oe)},refresh:t,isAwake:function(){return i},setCursor:function(e){p.css("cursor",e)},enableHandles:l,enableOnly:function(){e=!0},showHandles:function y(){e&&D.show()},disableHandles:h,animMode:f,setBgOpacity:d,done:function m(){f(!1),t()}}}(),Q=function(){var r=function(){},i=function(){},a=C.trackDocument;function s(e){return r(h(e)),!1}function c(e){return e.preventDefault(),e.stopPropagation(),K&&(K=!1,i(h(e)),V.isAwake()&&C.onSelect.call(oe,z(G.getFixed())),function t(){Y.css({zIndex:290}),he(document).unbind(".jcrop")}(),r=function(){},i=function(){}),!1}function u(e){return r(h(X.cfilter(e))),!1}function d(e){return c(X.cfilter(e))}return a||Y.mousemove(s).mouseup(c).mouseout(c),O.before(Y),{activateHandlers:function l(e,t,n){return K=!0,r=e,i=t,function o(e){Y.css({zIndex:450}),e?he(document).bind("touchmove.jcrop",u).bind("touchend.jcrop",d):a&&he(document).bind("mousemove.jcrop",s).bind("mouseup.jcrop",c)}(n),!1},setCursor:function t(e){Y.css("cursor",e)}}}(),U=function(){var t=he('<input type="radio" />').css({position:"fixed",left:"-120px",width:"12px"}).addClass("jcrop-keymgr"),e=he("<div />").css({position:"absolute",overflow:"hidden"}).append(t);function n(e,t,n){C.allowMove&&(G.moveOffset([t,n]),V.updateVisible(!0)),e.preventDefault(),e.stopPropagation()}return C.keySupport&&(t.keydown(function o(e){if(e.ctrlKey||e.metaKey)return!0;var t=!!e.shiftKey?10:1;switch(e.keyCode){case 37:n(e,-t,0);break;case 39:n(e,t,0);break;case 38:n(e,0,-t);break;case 40:n(e,0,t);break;case 27:C.allowSelect&&V.release();break;case 9:return!0}return!1}).blur(function r(e){t.hide()}),a||!C.fixedSupport?(t.css({position:"absolute",left:"-20px"}),e.append(t).insertBefore(O)):t.insertBefore(O)),{watchKeys:function i(){C.keySupport&&(t.show(),t.focus())}}}();function Z(e){$([e[0]/R,e[1]/T,e[2]/R,e[3]/T]),C.onSelect.call(oe,z(G.getFixed())),V.enableHandles()}function $(e){G.setPressed([e[0],e[1]]),G.setCurrent([e[2],e[3]]),V.update()}function _(){C.disabled=!0,V.disableHandles(),V.setCursor("default"),Q.setCursor("default")}function ee(){C.disabled=!1,ne()}function te(e,t,n){var o=t||C.bgColor;C.bgFade&&function r(){return he.fx.step.hasOwnProperty("backgroundColor")}()&&C.fadeTime&&!n?e.animate({backgroundColor:o},{queue:!1,duration:C.fadeTime}):e.css("backgroundColor",o)}function ne(e){C.allowResize?e?V.enableOnly():V.enableHandles():V.disableHandles(),Q.setCursor(C.allowSelect?"crosshair":"default"),V.setCursor(C.allowMove?"move":"default"),C.hasOwnProperty("trueSize")&&(R=C.trueSize[0]/y,T=C.trueSize[1]/m),C.hasOwnProperty("setSelect")&&(Z(C.setSelect),V.done(),delete C.setSelect),N.refresh(),C.bgColor!=q&&(te(C.shade?N.getShades():j,C.shade&&C.shadeColor||C.bgColor),q=C.bgColor),L!=C.bgOpacity&&(L=C.bgOpacity,C.shade?N.refresh():V.setBgOpacity(L)),B=C.maxSize[0]||0,P=C.maxSize[1]||0,J=C.minSize[0]||0,A=C.minSize[1]||0,C.hasOwnProperty("outerImage")&&(O.attr("src",C.outerImage),delete C.outerImage),V.refresh()}X.support&&Y.bind("touchstart.jcrop",X.newSelection),D.hide(),ne(!0);var oe={setImage:function re(r,i){V.release(),_();var a=new Image;a.onload=function(){var e=a.width,t=a.height,n=C.boxWidth,o=C.boxHeight;O.width(e).height(t),O.attr("src",r),F.attr("src",r),s(O,n,o),y=O.width(),m=O.height(),F.width(y).height(m),Y.width(y+2*W).height(m+2*W),j.width(y).height(m),N.resize(y,m),ee(),"function"==typeof i&&i.call(oe)},a.src=r},animateTo:function ie(e,t){var n=e[0]/R,o=e[1]/T,r=e[2]/R,i=e[3]/T;if(!E){var a=G.flipCoords(n,o,r,i),s=G.getFixed(),c=[s.x,s.y,s.x2,s.y2],u=c,d=C.animationDelay,l=a[0]-c[0],h=a[1]-c[1],f=a[2]-c[2],p=a[3]-c[3],g=0,b=C.swingSpeed;n=u[0],o=u[1],r=u[2],i=u[3],V.animMode(!0);var w=function(){g+=(100-g)/b,u[0]=Math.round(n+g/100*l),u[1]=Math.round(o+g/100*h),u[2]=Math.round(r+g/100*f),u[3]=Math.round(i+g/100*p),99.8<=g&&(g=100),g<100?($(u),v()):(V.done(),V.animMode(!1),"function"==typeof t&&t.call(oe))};v()}function v(){window.setTimeout(w,d)}},setSelect:Z,setOptions:function ae(e){r(e),ne()},tellSelect:function se(){return z(G.getFixed())},tellScaled:function ce(){return G.getFixed()},setClass:function ue(e){j.removeClass().addClass(S("holder")).addClass(e)},disable:_,enable:ee,cancel:function de(){V.done(),Q.activateHandlers(null,null)},release:V.release,destroy:function le(){j.remove(),b.show(),b.css("visibility","visible"),he(e).removeData("Jcrop")},focus:U.watchKeys,getBounds:function(){return[y*R,m*T]},getWidgetSize:function(){return[y,m]},getScaleFactor:function(){return[R,T]},getOptions:function(){return C},ui:{holder:j,selection:I}};return o&&j.bind("selectstart",function(){return!1}),b.data("Jcrop",oe),oe},he.fn.Jcrop=function(e,t){var n;return this.each(function(){if(he(this).data("Jcrop")){if("api"===e)return he(this).data("Jcrop");he(this).data("Jcrop").setOptions(e)}else"IMG"==this.tagName?he.Jcrop.Loader(this,function(){he(this).css({display:"block",visibility:"hidden"}),n=he.Jcrop(this,e),he.isFunction(t)&&t.call(n)}):(he(this).css({display:"block",visibility:"hidden"}),n=he.Jcrop(this,e),he.isFunction(t)&&t.call(n))}),this},he.Jcrop.Loader=function(e,t,n){var o=he(e),r=o[0];o.bind("load.jcloader",function i(){r.complete?(o.unbind(".jcloader"),he.isFunction(t)&&t.call(r)):window.setTimeout(i,50)}).bind("error.jcloader",function(e){o.unbind(".jcloader"),he.isFunction(n)&&n.call(r)}),r.complete&&he.isFunction(t)&&(o.unbind(".jcloader"),t.call(r))},he.Jcrop.defaults={allowSelect:!0,allowMove:!0,allowResize:!0,trackDocument:!0,baseClass:"jcrop",addClass:null,bgColor:"black",bgOpacity:.6,bgFade:!1,borderOpacity:.4,handleOpacity:.5,handleSize:null,aspectRatio:0,keySupport:!0,createHandles:["n","s","e","w","nw","ne","se","sw"],createDragbars:["n","s","e","w"],createBorders:["n","s","e","w"],drawBorders:!0,dragEdges:!0,fixedSupport:!0,touchSupport:null,shade:null,boxWidth:0,boxHeight:0,boundary:2,fadeTime:400,animationDelay:20,swingSpeed:3,minSelect:[0,0],maxSize:[0,0],minSize:[0,0],onChange:function(){},onSelect:function(){},onDblClick:function(){},onRelease:function(){}}}(jQuery);