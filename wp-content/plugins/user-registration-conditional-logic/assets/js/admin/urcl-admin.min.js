jQuery(function(e){function t(){var t="";return e(".ur-grid-lists .ur-selected-item .ur-general-setting").each(function(){var i=e(this).closest(".ur-selected-item").find(" .ur-admin-template .ur-label label").text(),o=e(this).closest(".ur-selected-item").find(" .ur-admin-template .ur-field").data("field-key");if("section_title"!=o&&"html"!=o&&"wysiwyg"!=o&&"billing_address_title"!=o&&"shipping_address_title"!=o){var l=e(this).find("[data-field='field_name']").val();void 0!==l&&(t+='<option value="'+l+'" data-type="'+o+'">'+i+"</option>")}}),t}function i(){if(e("#user_registration_form_setting_enable_assign_user_role_conditionally").is(":checked"))if(0===e(".urcl-role-container").length){var i=e(urcl_data.users_roles_conditional_fields),o=i.find(".urcl-field-conditional-field-select"),l='<option value="">-- Select --</option>'+t();o.each(function(){var t=e(this).val();e(this).html(l),e(this).val(t),e(this).find('option[value="'+t+'"]').prop("selected",!0)}),e("#user_registration_form_setting_enable_assign_user_role_conditionally").closest(".urcl-form-settings-enable-assign-user-role").after(i)}else e(".urcl-role-container").show();else e(".urcl-role-container").hide()}function o(t,i){var o=e("option:selected",i).attr("data-type"),l=e("option:selected",i).val(),n=e(i).closest(t).find(".urcl-value").children().first(),r=n.attr("name"),c=n.attr("class");if("checkbox"==o||"radio"==o||"select"==o||"country"==o||"billing_country"==o||"shipping_country"==o||"select2"==o||"multi_select2"==o){if("select"==o||"select2"==o||"multi_select2"==o)var a=e('.ur-selected-inputs .ur-selected-item .ur-general-setting-field-name input[value="'+l+'"]').closest(".ur-selected-item").find(".ur-field option").map(function(){return e(this).val()});else if("country"==o||"billing_country"==o||"shipping_country"==o)e('.ur-selected-inputs .ur-selected-item .ur-general-setting-field-name input[value="'+l+'"]').closest(".ur-selected-item").find(".ur-field option").map(function(){return e(this).val()}),e('.ur-selected-inputs .ur-selected-item .ur-general-setting-field-name input[value="'+l+'"]').closest(".ur-selected-item").find(".ur-field option").map(function(){return e(this).text()});else a=e('.ur-selected-inputs .ur-selected-item .ur-general-setting-field-name input[value="'+l+'"]').closest(".ur-selected-item").find(".ur-field input").map(function(){return e(this).val()});var u="<option value>--select--</option>";if("country"==o||"billing_country"==o||"shipping_country"==o){var s=e('.ur-general-setting-field-name input[value="'+l+'"').closest(".ur-selected-item").find(".ur-advance-selected_countries select option:selected"),d=[];e(this).find(".urcl-value select").html('<option value="">--select--</option>'),s.each(function(){var t=e(this).val(),i=e(this).text();d.push('<option value="'+t+'">'+i+"</option>")}),u=d.join("")}else 1==a.length&&""===a[0]?u='<option value="1">'+urcl_data.checkbox_checked+"</option>":e(a).each(function(e,t){u=u+'<option value="'+t+'">'+t+"</option>"});n.replaceWith('<select name="'+r+'" class="'+c+'">'+u+"</select>")}else n.replaceWith('<input type="text" name="'+r+'" class="'+c+'">')}var l={init:function(){e(document.body).on("ur_rendered_field_options ur_new_field_created",function(){l.renderConditionalLogicMapUI()}),e(document.body).on("change",".ur-enable-conditional-logic",function(){var t=e(this).is(":checked");e(".ur-selected-item.ur-item-active").find(".ur-enable-conditional-logic").attr("checked",t),t?(e("#ur-setting-form .urcl-logic-creator").slideDown(),e(".ur-selected-item.ur-item-active").find(".urcl-logic-creator").show()):(e("#ur-setting-form .urcl-logic-creator").slideUp(),e(".ur-selected-item.ur-item-active").find(".urcl-logic-creator").hide())}),e(document.body).on("click",".urcl-add-new-group",function(t){t.preventDefault();var i=l.resolve_smart_tags(urcl_data.templates.group,{urcl_conditions:l.createField()});e("#ur-setting-form .urcl-logic-map-container").append(i),l.udpateRuleJSON()}),e(document.body).on("click",".urcl-add-field",function(){var t=e(this).closest(".urcl-conditional-logic__group");1===t.find(".urcl-field").length&&0===t.find(".urcl-logic-gate.is-active").length&&t.find(".urcl-logic-gate-or").addClass("is-active"),e(this).closest(".urcl-field").after(l.createField()),l.udpateRuleJSON()}),e(document.body).on("click",".urcl-remove-group",function(){if(e(this).closest(".urcl-logic-map-container").find(".urcl-group").length>1){var t=e(this);Swal.fire({type:"warning",title:"Are you sure?",text:"Are you sure you want to remove the Conditional Logic group? You will not be able to revert this action.",confirmButtonText:"Yeah! Go Ahead.",showCancelButton:!0}).then(function(e){e.value&&(t.closest(".urcl-group").remove(),l.udpateRuleJSON())})}else Swal.fire({type:"error",title:"Nope!",text:"You have to leave at least ONE group."})}),e(document.body).on("click",".urcl-remove-field",function(){if(e(this).closest(".urcl-conditions-container").find(".urcl-field").length>1){var t=e(this),i=e(this).closest(".urcl-conditional-logic__group");Swal.fire({type:"warning",title:"Are you sure?",text:"Are you sure you want to remove the Conditional Logic field? You will not be able to revert this action.",confirmButtonText:"Yeah! Go Ahead.",showCancelButton:!0}).then(function(e){e.value&&(t.closest(".urcl-field").remove(),1===i.find(".urcl-field").length&&i.find(".urcl-logic-gate.is-active").length&&i.find(".urcl-logic-gate").removeClass("is-active"),l.udpateRuleJSON())})}else Swal.fire({type:"error",title:"Nope!",text:"You have to leave at least ONE field in a group."})}),e(document.body).on("change",".urcl-action-input, .urcl-root-logic-gate, .urcl-triggerer-field, .urcl-field-operator, .urcl-field-value",function(){l.udpateRuleJSON()}),e(document.body).on("change",".urcl-triggerer-field",function(){var t=e(this).val(),i=l.getInputElementForCLField(t);e(this).closest(".urcl-field").find(".urcl-field-value").remove(),e(this).closest(".urcl-field").find(".urcl-field-operator").after(i),l.udpateRuleJSON()}),e(document.body).on("click",".urcl-logic-gate",function(){e(this).is(".is-active")||(e(this).closest(".urcl-logic-gate-container").find(".urcl-logic-gate.is-active").removeClass("is-active"),e(this).addClass("is-active"),l.udpateRuleJSON())})},resolve_smart_tags:function(e,t,i){var o;return e&&t&&"object"==typeof t&&Object.keys(t).forEach(function(i){o=new RegExp("{{{"+i+"}}}","g"),e=e.replace(o,t[i])}),i&&Array.isArray(i)&&i.length&&i.forEach(function(t){t&&"object"==typeof t&&t.placeholder&&""!==t.placeholder&&(o=new RegExp("{{{"+t.placeholder+":"+t.tag+"}}}","g"),e=e.replace(o,t.value),o=new RegExp("{{{"+t.placeholder+":[A-z0-9_]+}}}","g"),e=e.replace(o,""))}),e},renderConditionalLogicMapUI:function(){var t=e("#ur-setting-form .urcl-logic-map").val(),i=null;try{t=(t=t.replace(/\\"/g,'"')).replace(/^"|"$/g,""),i=JSON.parse(t)}catch(c){}if(i){var o=i.logic_map,n=e("#ur-setting-form .urcl-logic-creator"),r=[];n.find(".urcl-action-input").val(i.action),n.find(".urcl-root-logic-gate").val(o.logic_gate),o.conditions.forEach(function(e){r.push(l.createGroup(e))}),n.find(".urcl-logic-map-container").html(r.join(""))}},createGroup:function(e){var t=[];return e||"object"==typeof e||(e={}),Array.isArray(e.conditions)&&e.conditions.forEach(function(e){t.push(l.createField(e))}),l.resolve_smart_tags(urcl_data.templates.group,{urcl_conditions:t.join("")},[{placeholder:"urcl_logic_gate",tag:e.logic_gate,value:"is-active"}])},createField:function(e){e||"object"==typeof e||(e={});return l.resolve_smart_tags(urcl_data.templates.field,{urcl_triggerer_input:l.getFormFields(e.triggerer_id,[l.getSelectedFieldId()]),urcl_field_value_input:l.getInputElementForCLField(e.triggerer_id,e.value)},[{placeholder:"operator",tag:e.operator,value:"selected"}])},getSelectedFieldId:function(){return e(".ur-selected-item.ur-item-active").find(".ur-general-setting-field-name .ur-general-setting-field").val()},getFormFields:function(t,i,o){var l,n,r,c,a=['<option value="***">--- Select a field ---</option>'];return Array.isArray(i)||(i=[]),Array.isArray(o)||(o=["phone","date","timepicker","file","profile_picture","single_item","section_title","html","wysiwyg","billing_address_title","shipping_address_title"]),e(".ur-selected-item").each(function(){l=e(this).find(".ur-field").data("field-key"),n=e(this).find(".ur-general-setting-label .ur-general-setting-field").val(),r=e(this).find(".ur-general-setting-field-name .ur-general-setting-field").val(),c="",l&&n&&r&&(i.includes(r)||o.includes(l)||(t===r&&(c='selected="selected"'),a.push('<option data-type="'+l+'" data-label="'+n+'" value="'+r+'" '+c+">"+n+"</option>")))}),'<select class="urcl-conditional-logic__rule__param urcl-triggerer-field">'+a.join("")+"</select>"},getInputElementForCLField:function(t,i){var o,l,n,r,c="";return e(".ur-selected-item").each(function(){if(u=e(this).find(".ur-field").data("field-key"),o=e(this).find(".ur-general-setting-field-name .ur-general-setting-field").val(),["checkbox","multi_select2"].includes(u)&&(u="checkbox"),["radio","select","select2"].includes(u)&&(u="radio"),["country","billing_country","shipping_country"].includes(u)&&(u="country"),["privacy_policy","mailchimp","separate_shipping"].includes(u)&&(u="check_uncheck"),t===o){switch(u){case"checkbox":l=[],e(this).find(".ur-general-setting-options .ur-options-list .ur-type-checkbox-label").each(function(){n="",e(this).val()===i&&(n="selected"),l.push('<option value="'+e(this).val()+'" '+n+">"+e(this).val()+"</option>")}),c='<select class="urcl-conditional-logic__rule__value urcl-field-value">'+l.join("")+"</select>";break;case"radio":l=[],e(this).find(".ur-general-setting-options .ur-options-list .ur-type-radio-label").each(function(){n="",e(this).val()===i&&(n="selected"),l.push('<option value="'+e(this).val()+'" '+n+">"+e(this).val()+"</option>")}),c='<select class="urcl-conditional-logic__rule__value urcl-field-value">'+l.join("")+"</select>";break;case"country":l=[],e(this).find(".ur-settings-selected-countries option:selected").each(function(){n="",e(this).val()===i&&(n="selected"),l.push('<option value="'+e(this).val()+'" '+n+">"+e(this).html()+"</option>")}),c='<select class="urcl-conditional-logic__rule__value urcl-field-value">'+l.join("")+"</select>";break;case"learndash_course":l=[];var a,u=e(".ur-general-setting-learndash_course .ur-general-setting-field-type select").val();"select_box"===u?e(this).find("#ur-input-type-learndash-course option").each(function(){n="",e(this).val()==i&&(n="selected=selected"),l.push('<option value="'+e(this).val()+'" '+n+">"+e(this).html()+"</option>")}):"check_box"===u&&e(this).find(".ur-input-type-learndash_course .ur-field input").each(function(){n="",a=e(this).data("value"),optionLabel=e(this).data("label"),a==i&&(n="selected=selected"),l.push('<option value="'+a+'" '+n+">"+optionLabel+"</option>")}),c='<select class="urcl-conditional-logic__rule__value urcl-field-value">'+l.join("")+"</select>";break;case"number":r="",i&&(r='value="'+i+'"'),c='<input type="number" class="urcl-conditional-logic__rule__value urcl-field-value" '+r+" />";break;case"check_uncheck":c='<select class="urcl-conditional-logic__rule__value urcl-field-value">'+(l=['<option value="checked" '+("checked"===i?"selected":"")+">Checked</option>",'<option value="unchecked" '+("unchecked"===i?"selected":"")+">UnChecked</option>"]).join("")+"</select>";break;default:r="",i&&(r='value="'+i+'"'),c='<input type="text" class="urcl-conditional-logic__rule__value urcl-field-value" '+r+" />"}return!1}}),c},udpateRuleJSON:function(){var t,i,o=e("#ur-setting-form .urcl-logic-creator"),l={action:o.find(".urcl-action-input").val(),logic_map:{type:"group",logic_gate:o.find(".urcl-root-logic-gate").val(),conditions:[]}},n=[],r=null;o.find(".urcl-logic-map-container .urcl-group").each(function(){t=[],i=e(this).find(".urcl-logic-gate.is-active").data("value"),e(this).find(".urcl-field").each(function(){t.push({type:"field",triggerer_id:e(this).find(".urcl-triggerer-field").val(),operator:e(this).find(".urcl-field-operator").val(),value:e(this).find(".urcl-field-value").val()})}),n.push({type:"group",logic_gate:i||"",conditions:t})}),l.logic_map.conditions=n,r=JSON.stringify(l),e("#ur-setting-form .urcl-logic-map").val(r),e(".ur-selected-item.ur-item-active").find(".urcl-logic-map").val(r)}};l.init(),i(),e(document).on("change","#user_registration_form_setting_enable_assign_user_role_conditionally",function(){i()});var n=urcl_data.users_roles_conditions_data;e(document).on("click",".urcl-role-logic-box .add",function(){condition_id=e(this).closest(".urcl-role-logic-box").attr("data-group");var i=e(this).closest(".urcl-role-logic-box").attr("data-last-key");i++;var o="urcl-conditional-group";1===e(this).closest(".urcl-or-groups").length&&(o="urcl-conditional-or-group"),$output='<li class="'+o+'" data-key='+i+">",$output+='<div class="urcl-form-group">',$output+='<select class="urcl-user-role-field urcl-field-conditional-field-select" name="user_registration_form_fields['+condition_id+"]["+i+']">',$output+='<option value="">-- Select --</option>',$output+=t(),$output+="</select></div>",$output+='<div class="urcl-operator"><select class="urcl-user-role-field" name="user_registration_form_operator['+condition_id+"]["+i+']">',$output+='<option value = "is" >is</option>',$output+='<option value = "is_not" >is not</option>',$output+='<option value = "empty"> empty </option>',$output+='<option value = "not_empty"> not empty </option>',$output+='<option value = "greater_than"> greater than </option>',$output+='<option value = "less_than"> less_than </option>',$output+="</select></div>",$output+='<div class="urcl-value"><input class="urcl-user-role-field" name = "user_registration_form_value['+condition_id+"]["+i+']" type="text" /></div>',$output+='<span class="add">',$output+="AND",$output+="</span>",$output+='<span class="remove">',$output+='<i class="dashicons dashicons-minus"></i>',$output+="</span></li>",e(this).closest(".urcl-role-logic-box").append($output),e(this).closest(".urcl-role-logic-box").attr("data-last-key",i)}),e(document).on("click",".urcl-role-logic-box .remove",function(){if(e(this).parent().hasClass("urcl-conditional-group"))e(this).parent().parent().find(".urcl-conditional-group").length>1?e(this).parent().remove():e(this).parent().parent().parent().find(".urcl-conditional-or-group").length>0&&(e(this).parent().parent().next(".urcl-or-label").remove(),e(this).parent().parent().remove());else if(e(this).parent().hasClass("urcl-conditional-or-group"))if(1==e(this).parent().parent().find(".urcl-conditional-or-group").length)if(0===e(this).parent().parent().parent().find(".urcl-conditional-group").length){var t=e(this).parent().parent().prev(".urcl-or-label").length,i=e(this).parent().parent().next(".urcl-or-label").length;0===t?i>0&&(e(this).parent().parent().next(".urcl-or-label").remove(),e(this).parent().parent().remove()):(e(this).parent().parent().prev(".urcl-or-label").remove(),e(this).parent().parent().remove())}else e(this).parent().parent().prev(".urcl-or-label").remove(),e(this).parent().parent().remove();else e(this).parent().remove()}),e(document).on("click",".urcl-role-logic-wrap .urcl-remove-condition",function(){e(this).parent().remove();1===e(".urcl-role-container").find(".urcl-role-logic-wrap").length&&e(".urcl-role-container").find(".urcl-remove-condition").remove()}),e(document).on("click",".urcl-role-container .urcl-add-new-condition",function(){if(1===e(".urcl-role-container").find(".urcl-role-logic-wrap").length){e(".urcl-role-container").find(".urcl-role-logic-wrap .urcl-add-or-condition").after('<button class="urcl-remove-condition"></button>')}var i=e(this).attr("data-last-conditionid");i++,$output='<div class="urcl-role-logic-wrap" data-group ="condition_'+i+'">',$output+='<div class="urcl-assign-role">',$output+='<p class="urcl-assign-label">'+urcl_data.assign+"</p>",$output+='<select class="urcl-user-role-field" name="user_registration_form_conditional_user_role[condition_'+i+']">',e.each(n.user_roles_list,function(e,t){$output+='<option value="'+e+'">'+t+"</option>"}),$output+="</select>",$output+="<p>"+urcl_data.only_if_following_matches+"</p>",$output+="</div>",$output+='<ul class="urcl-role-logic-box" data-group ="condition_'+i+'" data-last-key="1">',$output+='<li class="urcl-conditional-group" data-key="1">',$output+='<div class="urcl-form-group">',$output+='<select class="urcl-user-role-field urcl-field-conditional-field-select" name="user_registration_form_fields[condition_'+i+'][1]">',$output+='<option value=""> -- Select --</option>',$output+=t(),$output+="</select></div>",$output+='<div class="urcl-operator"><select class="urcl-user-role-field" name="user_registration_form_operator[condition_'+i+'][1]">',$output+='<option value = "is" >is</option>',$output+='<option value = "is_not" >is not</option>',$output+='<option value = "empty"> empty </option>',$output+='<option value = "not_empty"> not empty </option>',$output+='<option value = "greater_than"> greater than </option>',$output+='<option value = "less_than"> less_than </option>',$output+="</select></div>",$output+='<div class="urcl-value"><input class="urcl-user-role-field" name="user_registration_user_registration_form_value[condition_'+i+'][1]" type="text" /></div>',$output+='<span class="add">',$output+="AND",$output+="</span>",$output+='<span class="remove">',$output+='<i class="dashicons dashicons-minus"></i>',$output+="</span></li>",$output+="</ul>",$output+='<button class="button button-secondary button-medium urcl-add-or-condition">Add OR Condition</button>',$output+='<button class="urcl-remove-condition"></button>',$output+="</div>",e(".urcl-role-conditional-container").append($output),e(this).attr("data-last-conditionid",i)}),e(document).on("click",".urcl-role-logic-wrap .urcl-add-or-condition",function(){var i=e(this).closest(".urcl-role-logic-wrap").attr("data-group"),o='<p class="urcl-or-label"> OR </p>';o+='<ul class="urcl-or-groups urcl-role-logic-box" data-group ="'+i+'" data-last-key="1">',o+='<li class="urcl-conditional-or-group" data-key="1">',o+='<div class="urcl-form-group">',o+='<select class="urcl-user-role-field urcl-field-conditional-field-select" name="user_registration_form_fields[condition_'+i+'][1]">',o+='<option value=""> -- Select --</option>',o+=t(),o+="</select></div>",o+='<div class="urcl-operator"><select class="urcl-user-role-field" name="user_registration_form_operator[condition_'+i+'][1]">',o+='<option value = "is" >is</option>',o+='<option value = "is_not" >is not</option>',o+='<option value = "empty"> empty </option>',o+='<option value = "not_empty"> not empty </option>',o+='<option value = "greater_than"> greater than </option>',o+='<option value = "less_than"> less_than </option>',o+="</select></div>",o+='<div class="urcl-value"><input class="urcl-user-role-field" name="user_registration_user_registration_form_value[condition_'+i+'][1]" type="text" /></div>',o+='<span class="add">',o+="AND",o+="</span>",o+='<span class="remove">',o+='<i class="dashicons dashicons-minus"></i>',o+="</span></li>",o+="</ul>",e(this).before(o)}),e(document).on("change",".urcl-conditional-group .urcl-field-conditional-field-select",function(){o(".urcl-conditional-group",this)}),e(document).on("change",".urcl-conditional-or-group .urcl-field-conditional-field-select",function(){o(".urcl-conditional-or-group",this)})});